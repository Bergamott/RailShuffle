import java.awt.*;import java.awt.image.*;import java.awt.event.*;import java.io.*;import java.awt.Color;import java.awt.Graphics2D;import java.awt.image.BufferedImage;import javax.imageio.ImageIO;import javax.imageio.ImageWriter;import javax.imageio.ImageWriteParam;import javax.imageio.IIOImage;import javax.imageio.stream.ImageOutputStream;import javax.swing.JFileChooser;import javax.swing.filechooser.*;import java.util.*;import java.io.File;import java.io.FileOutputStream;import java.io.FileInputStream;// Turns pictures into BW/transparent with #220000 as dark color// usage: java sepiate infile.png [outfile.png]public class sepiate{	public static void main(String args[])	{		BufferedImage m_original;		String outName;		int w,h;		int i,j,k,l,m,n;		int inPix[];		try{			if (args.length==2)				outName = args[1];			else				outName = args[0];								m_original=ImageIO.read(new FileInputStream(args[0]));				w=m_original.getWidth();				h=m_original.getHeight();				inPix=new int[w*h];				m_original.getRGB(0,0,w,h,inPix,0,w);								k = w*h;				for (i=0;i<k;i++)				{					l = inPix[i];					m = ((l & 0xff0000)>>16) + ((l & 0xff00)>>8) + (l & 0xff);					n = ((l & 0xff000000)>>>24);					m = (m * n + 765 * (255 - n)) / 255;					//					if (i==0)//						System.out.println("l:"+l+", m:"+m+", n:"+n);										inPix[i] = 0x220000 | ((255 - m/3) << 24);				}				BufferedImage m_outImage=new BufferedImage(w,h,BufferedImage.TYPE_INT_ARGB);				m_outImage.setRGB(0,0,w,h,inPix,0,w);				savePng(m_outImage,outName);		}		catch(Exception e){e.printStackTrace();}	}		public static void savePng(BufferedImage bI, String nam)	{		try{			Iterator iterator = ImageIO.getImageWritersBySuffix("png");			if (! iterator.hasNext())			{				throw new IllegalStateException("no writers found");			}			ImageWriter iw = (ImageWriter)iterator.next();			FileOutputStream os = new FileOutputStream(nam);			ImageOutputStream ios = ImageIO.createImageOutputStream(os);			iw.setOutput(ios);			ImageWriteParam iwp = iw.getDefaultWriteParam();			iw.write(bI);			System.out.println("Saved "+nam);		}catch(Exception e){e.printStackTrace();}	}}